{% extends "layout.html" %}
{% load static %}

{% block body %}

    {{ warning }}

    <div class="container mt-3">
        <div class="row">
            <div class="col-md-12">
                <div class="mb-4 border rounded-lg shadow-sm p-3">
                    <div class=""><i class="bi bi-6-square-fill"></i><h3>Create Job Post</h3></div>
                    <hr>
                    {{ selected_job_post }}
                        

                    <!---------------------------------------------------------------------------------->
                        {% if is_job_post_owner %}
                            <hr>
                            <a href="{% url 'job_post:edit_job_post' selected_job_post.pk %}">
                                <button>Edit</button>
                            </a>
                            
                            <button class="show_delete_dialog">Delete</button>
                    
                            <dialog style="border-radius: 10px;">
                                <header>
                                    <h2>Confirm Deletion</h2>
                                </header>
                                <div>
                                    Are you sure you want to permanently remove this job post?
                                </div>
                                <footer>
                                    <menu>
                                        <button class="btn btn-danger ml-5" id="dialog-footer--confirm-btn" job_post_id="{{ selected_job_post.pk }}">Confirm</button>
                                        <button class="btn btn-success ml-5" id="dialog-footer--cancel-btn">Cancel</button>
                                    </menu>
                                </footer>
                            </dialog>
                        {% endif %}
                    <!---------------------------------------------------------------------------------->
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-3">
        <div class="row">
            <div class="col-md-12">
                <div class="mb-4 border rounded-lg shadow-sm p-3">
                    <div class=""><i class="bi bi-6-square-fill"></i><h3>Create Job Post</h3></div>
                    <hr>
                    {% if is_job_post_owner %}
                        {{ all_applicants }}

                        <hr>
                        <p><a href="{% url 'job_post:generate_pdf' selected_job_post.pk %}" download>Download Applicants List (PDF)</a></p>
                    {% endif %}
                        
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block script %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelector('.show_delete_dialog').onclick = () => {
            document.querySelector('dialog').showModal()
            document.querySelector('#dialog-footer--cancel-btn').onclick = () => {
                document.querySelector('dialog').close()
            }
            document.querySelector('#dialog-footer--confirm-btn').onclick = () => {
                <!-- console.log(`/update_job_post/{{ selected_job_post.pk }}`) -->
                fetch(`/update_job_post/{{ selected_job_post.pk }}`, {
                    method: 'PUT',
                    body: JSON.stringify({
                        delete: true
                    })
                }).then(() => {
                    return window.location.replace("{% url 'job_post:posted_job_posts' %}")
                })             
            }
        }
    })
</script>
{% endblock %}