{% extends "layout.html" %}
{% load static %}

{% block body %}
<div class="container-fluid p-4">
    <div class="row">
        <!-- BEGIN FILTERS -->
        <div class="col-md-2">
            <div  class="mb-4 border rounded-lg shadow-sm p-3">
                <div class="d-flex align-items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-funnel-fill mr-1" viewBox="0 0 16 16">
                        <path d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5z" />
                    </svg>
                    <div>Filters</div>
                </div>
                <hr />
                <!-- BEGIN FILTER BY CATEGORY -->
                <form>
                    <div class="font-weight-bold mb-2">Job Type</div>
                    {% for choice in job_type_choices %}
                    <div class="checkbox">
                        <label><input type="checkbox" name="job_type" value="{{ choice.1 }}" class="filter_checkbox" /> {{ choice.1 }}</label>
                    </div>
                    {% endfor %}

                    <div class="font-weight-bold mb-2">Related Major</div>
                    {% for major in all_major %}
                    <div class="checkbox">
                        <label><input type="checkbox" name="job_major" value="{{ major.pk }}" class="filter_checkbox" /> {{ major.major_id }}</label>
                    </div>
                    {% endfor %}

                    <div class="font-weight-bold mb-2">Status</div>
                    {% for choice in job_status_choices %}
                    <div class="checkbox">
                        <label><input type="checkbox" name="job_status" value="{{ choice.1 }}" class="filter_checkbox" /> {{ choice.1 }}</label>
                    </div>
                    {% endfor %}
                </form>
                <!-- END FILTER BY CATEGORY -->
            </div>
        </div>

        <div class="col-md-10">
            <div class=""><i class="bi bi-6-square-fill"></i>All Jobs</div>
            <hr />
            <!-- BEGIN SEARCH INPUT -->
            <form action="{% url 'job_post:index' %}" method="GET" class="flex-grow-1">
                <div class="d-flex">
                    <input type="search" class="form-control" placeholder="Search..." name="search_term" value="{{ search_term }}" />
                    <span class="input-group-btn ml-2">
                        <button class="btn btn-dark" type="submit"><i class="fa fa-search"></i></button>
                    </span>
                </div>
            </form>
            <!-- END SEARCH INPUT -->

            <div class="mt-3">
                {% if not all_job_posts %}
                    <div class="card">
                        <div class="card-body no-result-found">No Result Found</div>
                    </div>
                {% else %} 
                    <div class="card card-body no-result-found-for-js">
                        <div>No Result Found</div>
                    </div>
                    {% for job_post in all_job_posts %}
                        <div class="job_post_div card mb-3">
                            <div class="row no-gutters align-items-center">
                                <!-- Need to change, link with company photo. Hard code for now -->
                                <div class="col-md-2">
                                    <div class="d-flex align-items-center justify-content-center">
                                        {% if job_post.company|slugify == 'agoda' %}
                                        <img src="{% static 'job_post/media/agoda.jpeg' %}" height="50px" />
                                        {% elif job_post.company|slugify == 'ey' %}
                                        <img src="{% static 'job_post/media/ey.png' %}" height="50px" />
                                        {% elif job_post.company|slugify == 'facebook' %}
                                        <img src="{% static 'job_post/media/facebook.jpg' %}" height="50px" />
                                        {% endif %}
                                    </div>
                                </div>
                                <!-- Need to change, link with company photo. Hard code for now -->

                                <div class="col-md-10">
                                    <div class="card-body">
                                        <h5 class="job_title card-title">{{ job_post.job_title }}</h5>
                                        <h6 class="company card-subtitle mb-3 text-muted">{{ job_post.company }}</h6>
                                        <div class="job_type card-text">{{ job_post.get_job_type_display }}</div>
                                        
                                        {% for major in job_post.job_major.all %}
                                            <span class="job_major badge badge-secondary">{{ major.pk }}</span>
                                        {% endfor %}

                                        <div class="d-flex align-items-center mt-3">
                                            {% if job_post.get_job_status_display == 'Active' %}
                                                <div class="status-badge mr-2 rounded-circle" id="show_active"></div>
                                            {% else %}
                                                <div class="status-badge mr-2 rounded-circle" id="show_inactive"></div>
                                            {% endif %}
                                            <div class="job_status card-text">{{ job_post.get_job_status_display }}</div>
                                        </div>

                                        <hr>

                                        <button class="btn btn-outline-dark mt-2">Read More</button>

                                        <div class="position-absolute" style="top: 20px; right: 20px">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
                                                <path
                                                    fill="currentColor"
                                                    d="M12 20.325q-.35 0-.712-.125t-.638-.4l-1.725-1.575q-2.65-2.425-4.788-4.812T2 8.15Q2 5.8 3.575 4.225T7.5 2.65q1.325 0 2.5.562t2 1.538q.825-.975 2-1.537t2.5-.563q2.35 0 3.925 1.575T22 8.15q0 2.875-2.125 5.275T15.05 18.25l-1.7 1.55q-.275.275-.637.4t-.713.125M11.05 6.75q-.725-1.025-1.55-1.563t-2-.537q-1.5 0-2.5 1t-1 2.5q0 1.3.925 2.763t2.213 2.837q1.287 1.375 2.65 2.575T12 18.3q.85-.775 2.213-1.975t2.65-2.575q1.287-1.375 2.212-2.837T20 8.15q0-1.5-1-2.5t-2.5-1q-1.175 0-2 .538T12.95 6.75q-.175.25-.425.375T12 7.25q-.275 0-.525-.125t-.425-.375m.95 4.725"
                                                />
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %} 
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            document.querySelector('.no-result-found-for-js').style.display = 'none'

            document.querySelectorAll('.filter_checkbox').forEach((checkbox) => {
                checkbox.onclick = () => {
                    let selected_job_type = []
                    let selected_job_major = []
                    let selected_job_status = []
                    var no_result_found = true
                    
                    console.log(selected_job_major)

                    document.getElementsByName('job_type').forEach((checkbox) => {
                        if(checkbox.checked) {
                            selected_job_type.push(checkbox.value)
                        }
                    })

                    document.getElementsByName('job_major').forEach((checkbox) => {
                        if(checkbox.checked) {
                            selected_job_major.push(checkbox.value)
                        }
                    }) 

                    document.getElementsByName('job_status').forEach((checkbox) => {
                        if(checkbox.checked) {
                            selected_job_status.push(checkbox.value)
                        }
                    })

                    document.querySelectorAll('.job_post_div').forEach((job_post) => {
                        const job_type = job_post.querySelector('.job_type').innerHTML
                        const job_status = job_post.querySelector('.job_status').innerHTML
                        let job_major = []
                        console.log(job_post.getElementsByClassName('job_major'))
                        if(job_post.getElementsByClassName('job_major') != null) {
                            job_major_list = job_post.getElementsByClassName('job_major')
                            for(let major of job_major_list) {
                                job_major.push(major.innerHTML)
                            }
                        }

                        pass_all_filter = false
                        pass_major_filter = false
                        pass_type_filter = false
                        pass_status_filter = false
                        
                        if(selected_job_major.length != 0) {
                            for(let selected_major of selected_job_major) {
                            for(let major of job_major) {
                                if(major == selected_major) {
                                    pass_major_filter = true
                                }
                            }
                        }
                        }
                        else {
                            pass_major_filter = true
                        }                   

                        if(selected_job_type.length != 0) {
                            if(selected_job_type.includes(job_type)) {
                                pass_type_filter = true
                            }
                        }
                        else {
                            pass_type_filter = true
                        }

                        if(selected_job_status.length != 0) {
                            if(selected_job_status.includes(job_status)) {
                                pass_status_filter = true
                            }
                        }
                        else {
                            pass_status_filter = true
                        }

                        if(pass_type_filter && pass_status_filter && pass_major_filter) {
                            pass_all_filter = true
                        }

                        if(pass_all_filter) {
                            job_post.style.display = 'block'
                            no_result_found = false
                        }
                        else {
                            job_post.style.display = 'none'
                        }                        
                    })
                    console.log((no_result_found && !document.querySelector('.no-result-found-for-js')))

                    if(no_result_found) {
                        document.querySelector('.no-result-found-for-js').style.display = 'block'
                    }
                    else {
                        document.querySelector('.no-result-found-for-js').style.display = 'none'
                    }                                                                                
                }
                
            })
        })
    </script>


{% endblock %}
