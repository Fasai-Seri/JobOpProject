{% extends "layout.html" %}
{% load static %}

{% block body %}
<div class="container-fluid p-4">
    <div class="row">
        <!-- BEGIN FILTERS -->
        <div class="col-md-2 bg-light">
            <div><h1>Main Page </h1></div>
            <h2 class="grid-title"><i class="fa fa-filter"></i> Filters</h2>
            <hr>
            <!-- BEGIN FILTER BY CATEGORY -->
            <form>    
                <h4>By Job Type:</h4>
                {% for choice in job_type_choices %}
                <div class="checkbox">
                <label><input type="checkbox" name="job_type" value="{{ choice.1 }}" class="filter_checkbox"> {{ choice.1 }}</label>
                </div>
                {% endfor %}
                <h4>By Related Major:</h4>
                {% for major in all_major %}
                <div class="checkbox">
                <label><input type="checkbox" name="job_major" value="{{ major.pk }}" class="filter_checkbox"> {{ major.major_id }}</label>
                </div>
                {% endfor %}
                <h4>Status:</h4>
                {% for choice in job_status_choices %}
                <div class="checkbox">
                <label><input type="checkbox" name="job_status" value="{{ choice.1 }}" class="filter_checkbox"> {{ choice.1 }}</label>
                </div>
                {% endfor %}
            </form>
            <!-- END FILTER BY CATEGORY -->
        </div>

        <div class="col-md-10">
            <h2><i class="fa fa-file-o"></i> All Jops</h2>
            <hr>
            <!-- BEGIN SEARCH INPUT -->
            <div class="input-group mb-3">
                <form action="{% url 'job_post:index' %}" method='GET'>
                    <input type="search" class="form-control" placeholder="Search.." name='search_term' value="{{ search_term }}">
                    <span class="input-group-btn">
                        <button class="btn btn-info" type="button"><i class="fa fa-search"></i></button>
                    </span>
                </form>
            </div>
            <p class="smtest">Showing all results matching " {{ search_term }} "</p>
            <!-- END SEARCH INPUT -->

            <form action="{% url 'job_post:index' %}" method='GET'>
            <input type="search" placeholder="Search.." name='search_term' value="{{ search_term }}">
            </form>

            

            {% if not all_job_posts %}
            No Result Found

                {% else %}

                    {% for job_post in all_job_posts %}
                    <div class="job_post_div">
                        <p class="job_title">{{ job_post.job_title }}</p>
                        <p class="company">{{ job_post.company }}</p>
                        <p class="job_type">{{ job_post.get_job_type_display }}</p>
                        {% for major in job_post.job_major.all %}
                        <span class="job_major">{{ major.pk }}</span>
                        {% endfor %}
                        <p class="job_status">{{ job_post.get_job_status_display }}</p>
                    </div>
                    {% endfor %}

            {% endif %}
        </div>
    </div>
</div>
{% endblock %}


{% block script %}
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.filter_checkbox').forEach((checkbox) => {
                checkbox.onclick = () => {
                    let selected_job_type = []
                    let selected_job_major = []
                    let selected_job_status = []

                    document.getElementsByName('job_type').forEach((checkbox) => {
                        if(checkbox.checked) {
                            selected_job_type.push(checkbox.value)
                        }
                    })

                    document.getElementsByName('job_major').forEach((checkbox) => {
                        if(checkbox.checked) {
                            selected_job_major.push(checkbox.value)
                        }
                    }) 

                    document.getElementsByName('job_status').forEach((checkbox) => {
                        if(checkbox.checked) {
                            selected_job_status.push(checkbox.value)
                        }
                    })

                    document.querySelectorAll('.job_post_div').forEach((job_post) => {
                        const job_type = job_post.querySelector('.job_type').innerHTML
                        const job_status = job_post.querySelector('.job_status').innerHTML
                        let job_major = []
                        console.log(job_post.getElementsByClassName('job_major'))
                        if(job_post.getElementsByClassName('job_major') != null) {
                            job_major_list = job_post.getElementsByClassName('job_major')
                            for(let major of job_major_list) {
                                job_major.push(major.innerHTML)
                            }
                        }

                        pass_all_filter = false
                        pass_major_filter = false
                        pass_type_filter = false
                        pass_status_filter = false
                        
                        if(selected_job_major.length != 0) {
                            for(let selected_major of selected_job_major) {
                            for(let major of job_major) {
                                if(major == selected_major) {
                                    pass_major_filter = true
                                }
                            }
                        }
                        }
                        else {
                            pass_major_filter = true
                        }                   

                        if(selected_job_type.length != 0) {
                            if(selected_job_type.includes(job_type)) {
                                pass_type_filter = true
                            }
                        }
                        else {
                            pass_type_filter = true
                        }

                        if(selected_job_status.length != 0) {
                            if(selected_job_status.includes(job_status)) {
                                pass_status_filter = true
                            }
                        }
                        else {
                            pass_status_filter = true
                        }

                        if(pass_type_filter && pass_status_filter && pass_major_filter) {
                            pass_all_filter = true
                        }

                        if(pass_all_filter) {
                            job_post.style.display = 'block'
                        }
                        else {
                            job_post.style.display = 'none'
                        }
                        
                        
                    })
                }
            })
        })
    </script>

    <style>
        .input-group {
    width: 100%; /* ทำให้ครอบเนื้อหาเต็มพื้นที่ */
    max-width: 500px; /* ปรับขนาดสูงสุดของช่องค้นหา */
    margin: auto; /* จัดกลางตามแนวนอน */
}

input[type="search"] {
    width: calc(100% - 40px); /* ลดขนาดของ input เพื่อให้มีพื้นที่สำหรับปุ่มค้นหา */
    border-radius: 20px; /* กำหนดขอบโค้งให้กับช่องค้นหา */
    padding: 10px; /* กำหนดการเรียงข้อความข้างในช่องค้นหา */
    font-size: 16px; /* กำหนดขนาดตัวอักษร */
}

.input-group-btn .btn {
    border-radius: 20px; /* กำหนดขอบโค้งให้กับปุ่มค้นหา */
    padding: 10px 20px; /* กำหนดการเรียงข้อความภายในปุ่มค้นหา */
    font-size: 16px; /* กำหนดขนาดตัวอักษร */
}

    </style>
{% endblock %}
